<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        
        <script type="text/javascript" src="components/jquery/dist/jquery.min.js"></script>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.bundle.js"></script>
        <script src="js/jquery.gridly.js" type="text/javascript"></script>
        <link href="css/jquery.gridly.css" rel="stylesheet" type="text/css" />
        <script src="components/jquery-ui-1.12.1/jquery-ui.js"></script>
        <style>
            body{
               margin:0;
               padding:0;
               height:100%;
            }
            img{
                height:100%;
            }
            #bgi{
                position:absolute;
                z-index:-1;
            }
            .container{

            }
            
            #gridContainer{
               margin-left: 5%;
               margin-right: 5%;
            }
            
            form{
                margin-top:2%;
            }
            
            .bottom{
                text-align: right;
                width:100%;
            }
            .bottom div{
                display:inline-block;
            }
            .bottom img{
                margin-right: 2%;
                display: inline-block;
            }
            .bottom img:hover{
                cursor: pointer;
            }
            
            .footer {
               position:absolute;
               bottom:0;
               width:100%;
               height:60px;   /* Height of the footer */
            }

            
          .gridly {
            position: relative;
            width: 960px;
            margin-top: 3%;
          }
            
            .brick{
                text-align:center;
                color: white;
            }
            .brick h1{
                margin-top:25%;
            }

          .brick.small {
            width: 70px;
            height: 70px;
          }
          .brick.large {
            width: 300px;
            height: 300px;
          }
            
            .expandable{
                position:absolute;
                height:100vh;
                width: 15vw;
                left: 85%;
                top: 0;
                background-color: #11b8ff;
                z-index: 1;
                display:none;
            }
            
            .expandable h2{
                color:white;
                text-align:center
            }

        </style>

    </head>

    <body>
        <script>
            
            function timer(){

           // console.log('function is being called');
                $.ajax({
                    url: "http://localhost:1337/bg",
                    success:function(data){
                        $('#bgi').fadeOut(function(){
                            //add date to end of get to circumvent caching issues and not loading new img
                            $("#bgi").attr('src', 'http://localhost:1337/bg?'+new Date().getTime());
                            $('#bgi').fadeIn();
                        }); 
                    }
                });               
            }
            
            var time = <%= config.timer %>;
            setInterval(timer, time);

        </script>
            
        <div class="expandable right">
            <h2>Widgets</h2>
            <div id="hideGridOpt" onclick="hide()" style="position: absolute; top: 8px; right:0"><img src="res/cross.png" height="24px" width="24px" alt="Close" style="color:white"></img></div>
        </div>
        
        <img id="bgi" src="http://localhost:1337/bg" width="100%" height="100%"></img>
    
        <div class="container">
            <div class="row top">
                <div class="col-xl-12">
                           
                    <form action="/search" method="post">
                        <input type="text" id="search" name="search" placeholder="Search" style="margin-left:20%; width:50%;"/>
                    </form>
                    
                </div>
            </div>
        </div>
        <div class="container" id="gridContainer">
            <div class="row main">
                <div class="col-xl-12">
                    <div class="gridly">
                            <% for(var i=0; i<bricks.bricks.length; i++){ %>
                                <div id="<%= bricks.bricks[i].name %>" data-url="<%= bricks.bricks[i].url %>" class="brick <%= bricks.bricks[i].size %>" style="background-color: <%= bricks.bricks[i].color %>">
                                    <h1><%= bricks.bricks[i].name.charAt(0).toUpperCase() %> </h1>
                                </div>
                            <% } %>
                    </div>
                </div>
                    <script>
  
                        function isEquivalent(a, b) {
    // Create arrays of property names
    var aProps = Object.getOwnPropertyNames(a);
    var bProps = Object.getOwnPropertyNames(b);

    // If number of properties is different,
    // objects are not equivalent
    if (aProps.length != bProps.length) {
        return false;
    }

    for (var i = 0; i < aProps.length; i++) {
        var propName = aProps[i];

        // If values of same property are not equal,
        // objects are not equivalent
        if (a[propName] !== b[propName]) {
            return false;
        }
    }

    // If we made it this far, objects
    // are considered equivalent
    return true;
}
                        
                    var elements = [];    
                    
                    //set order of elements
                    var reordering = function($elements) {
                       elements = $elements;
                    };    
                    
                    //check if order of elements has changed.
                    //if no, return
                    //if yes, post to server and write changes
                    var reordered = function($elements) {

                     if(isEquivalent($elements, elements)){
                         return;
                     } else {
                      var bricks = []; 
                       for(var i=0; i<$elements.length; i++){
                           var name = $elements[i].id;
                           var url = $elements[i].getAttribute('data-url');
                           var color = $elements[i].style.backgroundColor;
                           var size = $elements[i].className.split(' ')[1];
                           var json = {name: name, url: url, color: color, size: size};
                           bricks.push(json);
                       }
                        $.ajax({
                            url:"/bricks",
                            type:"POST",
                            data: {"bricks":bricks}
                        });
                     }

                    };

                      $('.gridly').gridly({
                        base: 30, // px 
                        gutter: 20, // px
                        columns: 12,
                        callbacks: { reordering: reordering, reordered: reordered }
                      });

                        function show(){
                            $(".expandable").show('slide', { direction: "right" }, 500);
                        }

                        function hide(){
                            $(".expandable").hide('slide', {direction: 'right'}, 500);
                        }
                             
                        
                        
                    </script>

            </div>
            
        </div>

    <footer class="footer"style="background-color:rgba(0, 0, 0, 0.0);">
            <div class="bottom">
                <div onclick="show()" id="gridOpts"><img src="res/grid.png" width="42px" height="42px" alt="Grid"></div>
                <div onclick="location.href='/options'"><img src="res/options.png" width="42px" height="42px" alt="Options"></div>
            </div>
    </footer>
    </body>
    
<script>
    document.getElementById("search").focus();
</script>
</html>